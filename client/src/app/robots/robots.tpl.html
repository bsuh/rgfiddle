<script type="text/ng-template" id="/client/vendor/src/app/robots/codemirror.tpl.html">
  <textarea ui-codemirror="codeMirrorOptions(robot.code)" ng-model="robot.code"></textarea>
</script>

<div ng-controller="RobotsCtrl" class="row">
  <tabset ng-init="getRobots()">
    <tab ng-repeat="robot in robots" active="robot.active">
      <tab-heading ng-switch="!!$first">
        <div ng-switch-when="false">
          {{robot.name}}
        </div>
        <div ng-switch-when="true">
          <span class="glyphicon glyphicon-plus"></span>&nbsp;New Robot
        </div>
      </tab-heading>
      <div class="col-xs-12">
        <div class="row editor">

          <!-- left column with code mirror -->
          <div class="col-md-8">
            <form class="form-inline">
              <div class="form-group">
                <input type="text" ng-model="robot.name"
                       id="newRobotNameInput" class="form-control" />
              </div>
              <button ng-click="updateRobot($index)"
                      class="btn btn-default">Save</button>
              <button ng-if="!$first" ng-click="updateRobot($index, true)"
                      class="btn btn-danger">Delete</button>
            </form>
            
            <!-- some hacky shit to make ui codemirror work properly w/ ng-repeat -->
            <div ng-if="robot.active"
                 ng-include="'/client/vendor/src/app/robots/codemirror.tpl.html'"></div>
          </div>

          <!-- right column with game map -->
          <div class="col-md-4">
            <p class="lead row">
              <span class="text-danger">{{robots[$index].name}}</span> vs
              <span class="text-primary">{{robots[opponent.index].name}}</span>
            </p>

            <div class="row">
              <div class="btn-group" ng-init="opponent.index = 0">
                <button class="btn btn-default dropdown-toggle">
                  Select opponent&nbsp;<span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li ng-repeat="robot in robots">
                    <a ng-click="opponent.index = $index">{{robot.name}}</a>
                  </li>
                </ul>
              </div>
              <button ng-click="runMatch($index, opponent.index)"
                      class="btn btn-primary">Run match</button>
            </div>

            <div ng-if="history">
              <rg-map board="history[match.turn].board" class="row"></rg-map>

              <div class="row">
                <input type="range" ng-model="match.turn"
                       min="0" max="{{history.length-1}}" step="1" value="0"/>
              </div>

              <div class="row">
                Turn: {{match.turn}}
                <span class="text-danger">
                  {{match.player1}}: {{history[match.turn].scores[0]}}
                </span>
                <span class="text-primary">
                  {{match.player2}}: {{history[match.turn].scores[1]}}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </tab>
  </tabset>
</div>
